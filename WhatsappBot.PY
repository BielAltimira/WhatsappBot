# moduls

from twilio.rest import Client
import requests
from bs4 import BeautifulSoup
import PySimpleGUI as sg

# layout

layout = [[sg.Text('SELECCIONA EL SERVEI')],
          [sg.Button('NIVELL DE POLÂ·LEN'), sg.Button('TOP ALÂ·ÃˆRGENS'), sg.Button("TEMPS"), sg.Button("TOT")]]
window = sg.Window('INFORMACIÃ“ METEOROLÃ’GICA I AMBIENTAL', layout)


# funcions


def nivell_polen():
    url = "https://www.eltiempo.es/manresa.html"
    page = requests.get(url)
    soup = BeautifulSoup(page.content, "html.parser")
    nivell = soup.find(class_="m_pollen-city").get_text()

    if "Alto" in nivell:
        message = "ğŸŒºNIVELL DE POLÂ·LEN: ALTâŒ"
    if "Bajo" in nivell:
        message = "ğŸŒºNIVELL DE POLÂ·LEN: BAIXâœ…"

    account_sid = 'AC8d4a271566dc045761c853cb9c8b00b1'
    auth_token = 'f84a37af61e08a44790acb9ee97bba57'
    client = Client(account_sid, auth_token)

    message = client.messages.create(
        from_='whatsapp:+14155238886',
        body=message,
        to='whatsapp:+34640768754'
    )


def top_alergens():
    url = "https://www.eltiempo.es/barcelona/polen"
    page = requests.get(url)
    soup = BeautifulSoup(page.content, "html.parser")
    taula = soup.find(class_="m_table-basic m_pollen-table").get_text()
    message = (f"TOP ALÂ·LÃˆRGENSğŸŒ· ğŸŒ¹  ğŸŒº ğŸŒ¸ ğŸŒ¼ ğŸŒ»{taula[25:83]}")

    account_sid = 'AC8d4a271566dc045761c853cb9c8b00b1'
    auth_token = 'f84a37af61e08a44790acb9ee97bba57'
    client = Client(account_sid, auth_token)

    message = client.messages.create(
        from_='whatsapp:+14155238886',
        body=message,
        to='whatsapp:+34640768754'
    )


def temps():
    url = "https://www.eltiempo.es/manresa.html"
    page = requests.get(url)
    soup = BeautifulSoup(page.content, "html.parser")

    max1 = soup.find(class_="m_table_weather_day_max_temp").get_text()
    min1 = soup.find(class_="m_table_weather_day_min_temp").get_text()
    plujes = soup.find(class_="m_table_weather_day_child m_table_weather_day_rain").get_text()
    vent = soup.find(class_="m_table_weather_day_wind_ico").get_text()

    message = (f"TEMPS D'AVUIâ˜€ğŸŒ¤ğŸŒ§ğŸŒ©ğŸŒ¨                                                     Avui, hi haurÃ n temperatures mÃ ximes de {max1} i mÃ­nimes de {min1}. PlourÃ n {plujes[9:13]} i el vent d'avui "
               f"tindrÃ  una velocitat de {vent[2:8]}.")

    account_sid = 'AC8d4a271566dc045761c853cb9c8b00b1'
    auth_token = 'f84a37af61e08a44790acb9ee97bba57'
    client = Client(account_sid, auth_token)

    message = client.messages.create(
        from_='whatsapp:+14155238886',
        body=message,
        to='whatsapp:+34640768754'
    )


# mainloop

while True:
    event, values = window.read()
    if event in (None, 'Cancel'):
        break
    if event == "NIVELL DE POLÂ·LEN":
        nivell_polen()
    if event == "TOP ALÂ·ÃˆRGENS":
        top_alergens()
    if event == "TEMPS":
        temps()
    if event == "TOT":
        nivell_polen()
        top_alergens()
        temps()

window.close()
